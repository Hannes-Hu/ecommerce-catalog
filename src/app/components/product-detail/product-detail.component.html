<div class="container mt-4">
  <app-loading-spinner *ngIf="loading$ | async"></app-loading-spinner>

  <div *ngIf="error$ | async as error" class="alert alert-danger" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
  </div>

  <div class="row" *ngIf="product$ | async as product; else noProduct">
    <div class="col-md-6">
      <div class="product-image-container">
        <img 
          [src]="product.image" 
          [alt]="product.title"
          class="img-fluid product-detail-image rounded shadow"
        >
      </div>
    </div>
    <div class="col-md-6">
      <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/"><i class="bi bi-house"></i> Home</a></li>
          <li class="breadcrumb-item">
            <a [routerLink]="['/category', product.category]">
              {{ product.category | titlecase }}
            </a>
          </li>
          <li class="breadcrumb-item active">{{ product.title | slice:0:30 }}{{ product.title.length > 30 ? '...' : '' }}</li>
        </ol>
      </nav>

      <h1 class="product-title display-6">{{ product.title }}</h1>
      
      <div class="rating mb-3">
        <span class="text-warning">
          <i class="bi bi-star-fill"></i>
          {{ product.rating.rate }}
        </span>
        <span class="text-muted ms-2">({{ product.rating.count }} reviews)</span>
      </div>

      <h2 class="text-primary mb-3">${{ product.price | number:'1.2-2' }}</h2>

      <p class="product-description lead">{{ product.description }}</p>

      <div class="category-badge mb-3">
        <span class="badge bg-info fs-6">{{ product.category | titlecase }}</span>
      </div>

      <!-- Cart Information -->
      <div *ngIf="isInCart$ | async" class="alert alert-info mb-3">
        <i class="bi bi-info-circle me-2"></i>
        This item is in your cart (Quantity: {{ quantityInCart$ | async }})
      </div>

      <div class="d-grid gap-2 d-md-flex">
        <button class="btn btn-primary btn-lg me-md-2 flex-fill" 
                (click)="addToCart()"
                [class.btn-success]="isInCart$ | async">
          <i class="bi" [class.bi-cart-plus]="!(isInCart$ | async)" [class.bi-cart-check]="isInCart$ | async"></i>
          {{ (isInCart$ | async) ? 'Added to Cart' : 'Add to Cart' }}
        </button>
        <button class="btn btn-outline-secondary btn-lg">
          <i class="bi bi-heart"></i> Wishlist
        </button>
      </div>

      <div class="mt-4">
        <div class="row text-center">
          <div class="col-4">
            <i class="bi bi-truck display-6 text-muted"></i>
            <p class="small mb-0">Free Shipping</p>
          </div>
          <div class="col-4">
            <i class="bi bi-arrow-clockwise display-6 text-muted"></i>
            <p class="small mb-0">30-Day Returns</p>
          </div>
          <div class="col-4">
            <i class="bi bi-shield-check display-6 text-muted"></i>
            <p class="small mb-0">Secure Checkout</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template #noProduct>
    <div *ngIf="!(loading$ | async) && !(error$ | async)" class="text-center py-5">
      <i class="bi bi-exclamation-circle display-1 text-muted"></i>
      <h4 class="mt-3 text-muted">Product not found</h4>
      <a routerLink="/" class="btn btn-primary mt-3">Back to Products</a>
    </div>
  </ng-template>
</div>